groups:
  - name: patch-lifecycle-alerts
    rules:
      - alert: PatchAppDown
        expr: up{job=~"patch-app-.*"} == 0
        for: 2m
        labels:
          severity: critical
          service: patch-lifecycle
        annotations:
          summary: "Patch app instance down"
          description: "Target {{ $labels.instance }} of job {{ $labels.job }} is down for over 2 minutes."

      - alert: PatchJvmHeapHigh
        expr: (jvm_memory_used_bytes{area="heap"} / jvm_memory_max_bytes{area="heap"}) > 0.85
        for: 5m
        labels:
          severity: warning
          service: patch-lifecycle
        annotations:
          summary: "JVM heap usage high"
          description: "Heap usage above 85% for 5 minutes on {{ $labels.instance }}."

      - alert: PatchHttp5xxHigh
        expr: sum(rate(http_server_requests_seconds_count{status=~"5.."}[5m])) by (job) > 1
        for: 5m
        labels:
          severity: warning
          service: patch-lifecycle
        annotations:
          summary: "High HTTP 5xx rate"
          description: "Job {{ $labels.job }} has HTTP 5xx rate > 1 req/s over 5 minutes."

      - alert: PatchDatabaseConnectionIssues
        expr: hikaricp_connections_active > hikaricp_connections_max * 0.9
        for: 5m
        labels:
          severity: warning
          service: patch-lifecycle
        annotations:
          summary: "HikariCP active connections high"
          description: "Database connection pool active usage > 90% on {{ $labels.instance }}."
